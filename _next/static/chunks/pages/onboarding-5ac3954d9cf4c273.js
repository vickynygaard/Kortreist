(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[627],{3792:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(7876),r=a(4232),l=a(300),o=a(9099),n=a(4957);function c(){let{userData:e}=(0,l.r)(),[t,a]=(0,r.useState)([]),[c,i]=(0,r.useState)(null),[d,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(""),[f,m]=(0,r.useState)(""),[b,g]=(0,r.useState)(!1),x=(0,o.useRouter)();(0,r.useEffect)(()=>{(null==e?void 0:e.accessToken)&&(async()=>{try{let t=await fetch("https://bouvetapi-frbah7fhh5cjdpfy.swedencentral-01.azurewebsites.net/api/Profile/allComp",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(!t.ok)throw Error("Feil ved henting av selskaper");let s=await t.json();a(s)}catch(e){console.error("❌ Kunne ikke hente selskaper:",e)}})()},[null==e?void 0:e.accessToken]),(0,r.useEffect)(()=>{(null==e?void 0:e.accessToken)&&(async()=>{try{let t=await fetch("https://bouvetapi-frbah7fhh5cjdpfy.swedencentral-01.azurewebsites.net/api/Profile/getUser",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(!t.ok)throw Error("Feil ved henting av brukerdata: ".concat(t.statusText));let a=await t.json();console.log("Fetched user profile:",a),i(a),a.companyId&&u(a.companyId),a.nickName&&p(a.nickName),a.address&&m(a.address)}catch(e){console.error("Feil ved henting av brukerdata:",e)}})()},[null==e?void 0:e.accessToken]);let v=async()=>{if(!(null==e?void 0:e.accessToken)||!d||!h||!f){alert("Vennligst fyll ut alle felter.");return}g(!0);try{if(!(await fetch("https://bouvetapi-frbah7fhh5cjdpfy.swedencentral-01.azurewebsites.net/api/Profile/companySet",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({companyId:d,nickName:h,address:f})})).ok)throw Error("Klarte ikke oppdatere profil");console.log("Brukerdata oppdatert"),x.push("/")}catch(e){console.error("Feil under lagring:",e),alert("Noe gikk galt. Pr\xf8v igjen.")}finally{g(!1)}};return(0,s.jsx)("div",{className:"bg-customYellow2 p-6 flex flex-col justify-center items-center",children:(0,s.jsxs)("div",{className:"w-full max-w-md bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-customViolet mb-6 text-center",children:"Fullf\xf8r profilen din"}),(0,s.jsx)("label",{className:"block mb-2 font-medium text-gray-700",children:"Velg selskap:"}),(0,s.jsxs)("select",{className:"w-full p-3 mb-4 rounded border",value:null!=d?d:"",onChange:e=>u(Number(e.target.value)),children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"Velg et selskap"}),t.map(e=>(0,s.jsx)("option",{value:e.companyId,children:e.name},e.companyId))]}),(0,s.jsx)("label",{className:"block mb-2 font-medium text-gray-700",children:"Kallenavn:"}),(0,s.jsx)("input",{type:"text",className:"w-full p-3 mb-4 rounded border",value:h,onChange:e=>p(e.target.value),placeholder:"F.eks. SuperPer"}),(0,s.jsx)("label",{className:"block mb-2 font-medium text-gray-700",children:"Adresse:"}),(0,s.jsx)(n.A,{selectedAddress:f,setSelectedAddress:m}),(0,s.jsx)("button",{onClick:v,disabled:b,className:"w-full bg-customViolet text-white p-3 rounded font-semibold hover:opacity-90 transition",children:b?"Lagrer...":"Fullf\xf8r"})]})})}},4957:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var s=a(7876),r=a(4232),l=a(300);function o(e){let{selectedAddress:t,setSelectedAddress:a}=e,[o,n]=(0,r.useState)(t),[c,i]=(0,r.useState)([]),[d,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),{userData:f}=(0,l.r)();async function m(e){u(!0);try{if(!(null==f?void 0:f.accessToken))return;let t=await fetch("https://bouvetapi-frbah7fhh5cjdpfy.swedencentral-01.azurewebsites.net/api/geocode?address=".concat(encodeURIComponent(e)),{headers:{Authorization:"Bearer ".concat(f.accessToken)}});if(!t.ok){console.error("Failed to fetch suggestions"),i([]);return}let a=await t.json();i(a.features||[])}catch(e){console.error("Error fetching suggestions",e),i([])}finally{u(!1)}}(0,r.useEffect)(()=>{n(t)},[t]),(0,r.useEffect)(()=>{if(!o.trim()){i([]);return}let e=setTimeout(()=>{m(o)},500);return()=>clearTimeout(e)},[o]);let b=e=>{n(e.properties.label),a(e.properties.label),i([]),p(!1)};return(0,s.jsxs)("div",{className:"address-autocomplete relative",children:[(0,s.jsxs)("div",{className:"relative mb-2",children:[(0,s.jsx)("input",{type:"text",value:o,placeholder:"F.eks. Storgata 1, Oslo",onChange:e=>{n(e.target.value)},onFocus:()=>p(!0),onBlur:()=>{setTimeout(()=>{p(!1),o!==t&&n(t)},150)},className:"w-full p-3 rounded border focus:outline-none focus:ring-2 focus:ring-customViolet"}),o&&(0,s.jsx)("button",{onClick:()=>{n(""),a(""),i([])},className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600",children:"\xd7"})]}),h&&!d&&c.length>0&&o.trim()&&(0,s.jsx)("ul",{className:"absolute z-10 w-full border border-gray-200 rounded shadow-md bg-white max-h-60 overflow-y-auto",children:c.map((e,t)=>(0,s.jsx)("li",{onMouseDown:()=>b(e),className:"p-2 hover:bg-gray-100 cursor-pointer",children:e.properties.label},"".concat(e.properties.osm_id,"-").concat(t)))}),h&&d&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 text-customViolet",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"})]}),(0,s.jsx)("span",{className:"text-gray-600",children:"Laster adresser..."})]}),h&&!d&&0===c.length&&o.trim()&&(0,s.jsxs)("div",{className:"p-2 text-gray-500 border rounded",children:["Ingen treff p\xe5 “",o,"”"]})]})}},6250:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/onboarding",function(){return a(3792)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(6250)),_N_E=e.O()}]);